<% product = price_alert.product %>
<div
  class="bg-white rounded-lg p-3 shadow-sm hover:shadow-md transition-shadow border border-gray-200"
  data-controller="collapsible"
>
  <div class="flex gap-3">
    <% if product.image_url.present? %>
      <div class="w-16 h-16 flex-shrink-0 rounded overflow-hidden bg-gray-100">
        <%= image_tag product.image_url,
                    alt: product.name,
                    class: "w-full h-full object-cover",
                    loading: "lazy" %>
      </div>
    <% end %>

    <div class="flex-1 min-w-0 flex flex-col justify-between">
      <div class="flex items-start justify-between gap-2">
        <%= link_to product, class: "block min-w-0" do %>
          <h4 class="font-medium text-sm text-gray-900 line-clamp-2 group-hover:text-gray-700">
            <%= product.name %>
          </h4>
        <% end %>

        <button
          type="button"
          data-action="click->collapsible#toggle"
          class="flex-shrink-0 p-1 text-gray-400 hover:text-gray-600 transition"
        >
          <svg
            data-collapsible-target="icon"
            class="w-5 h-5 transition-transform duration-200"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>
      </div>

      <div class="flex items-center justify-between">
        <span class="text-xs text-gray-600">Current Price</span>
        <% if product.current_price %>
          <span class="text-base font-semibold text-gray-900">
            $<%= number_with_precision(product.current_price, precision: 2) %>
          </span>
        <% else %>
          <span class="text-gray-400">--</span>
        <% end %>
      </div>
    </div>
  </div>
  <div data-collapsible-target="content" class="pt-3 border-t border-gray-100">
    <%= link_to product, class: "block mb-3" do %>
      <p class="text-xs text-gray-500 truncate">
        <%= truncate(product.url, length: 50) %>
      </p>
    <% end %>

    <div class="space-y-2 text-xs">
      <div id="price_alert_<%= price_alert.id %>_card">
        <%= render "price_alerts/alert_target_price_card", price_alert: price_alert %>
      </div>
    </div>

    <%= render 'layouts/delete_modal',
          title: product.name,
          message: "Are you sure you want to delete the price alert?",
          path: price_alert_path(price_alert),
          method: :delete,
          button_text: 'Delete' %>
  </div>
</div>
