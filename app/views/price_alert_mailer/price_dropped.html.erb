<!DOCTYPE html>
<html>
  <head>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type' />
    <style>
      body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; }
      .container { max-width: 600px; margin: 0 auto; padding: 20px; }
      .header { background: #000; color: white; padding: 20px; text-align: center; border-radius: 8px 8px 0 0; }
      .content { background: white; padding: 30px; border: 1px solid #e5e7eb; border-top: none; border-radius: 0 0 8px 8px; }
      .price-box { background: #f3f4f6; padding: 20px; border-radius: 8px; margin: 20px 0; text-align: center; }
      .current-price { font-size: 32px; font-weight: bold; color: #16a34a; }
      .target-price { font-size: 18px; color: #6b7280; margin-top: 10px; }
      .savings { font-size: 18px; color: #16a34a; font-weight: 600; margin-top: 10px; }
      .product-info { margin: 20px 0; }
      .product-name { font-size: 20px; font-weight: 600; margin-bottom: 10px; }
      .button { display: inline-block; background: #000; color: white; padding: 12px 24px; text-decoration: none; border-radius: 8px; font-weight: 600; margin-top: 20px; }
      .footer { text-align: center; color: #6b7280; font-size: 14px; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e5e7eb; }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1 style="margin: 0;">Price Drop Alert!</h1>
      </div>

      <div class="content">
        <div class="product-info">
          <div class="product-name"><%= @product.name %></div>

          <% if @product.image_url.present? %>
            <img src="<%= @product.image_url %>" alt="<%= @product.name %>" style="max-width: 200px; border-radius: 8px; margin: 15px 0;" />
          <% end %>
        </div>

        <div class="price-box">
          <div class="current-price">
            $<%= number_with_precision(@product.current_price, precision: 2) %>
          </div>
          <div class="target-price">
            Your target: $<%= number_with_precision(@price_alert.target_price, precision: 2) %>
          </div>
          <% savings = @price_alert.target_price - @product.current_price %>
          <% if savings > 0 %>
            <div class="savings">
              You're saving $<%= number_with_precision(savings, precision: 2) %> below your target!
            </div>
          <% end %>
        </div>

        <p style="margin: 20px 0;">
          Great news! The price for <strong><%= @product.name %></strong> has dropped to
          <strong>$<%= number_with_precision(@product.current_price, precision: 2) %></strong>,
          which is at or below your target price of
          <strong>$<%= number_with_precision(@price_alert.target_price, precision: 2) %></strong>.
        </p>

        <p>Don't miss out on this deal!</p>

        <center>
          <%= link_to "View Product", product_url(@product), class: "button" %>
        </center>

        <div class="footer">
          <p>
            <%= link_to "Manage your alerts", price_alerts_url, style: "color: #6b7280;" %> |
            <%= link_to "View product page", product_url(@product), style: "color: #6b7280;" %>
          </p>
        </div>
      </div>
    </div>
  </body>
</html>
