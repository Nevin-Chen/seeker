<div data-product-id="<%= @product.id %>">
<div class="max-w-3xl mx-auto">
  <div data-controller="modal">
    <%= link_to price_alerts_path, class: "inline-flex items-center gap-1 text-sm text-gray-600 hover:text-gray-900 mb-6 transition-colors" do %>
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
      Back to My Alerts
    <% end %>

    <div class="bg-white rounded-xl shadow-sm ring-1 ring-black/5 p-7 sm:p-8 mb-6">
      <%= render "products/product_details", product: @product, price_alert: @price_alert %>
    </div>

    <% if @product.price_histories.any? %>
      <div class="bg-white rounded-xl shadow-sm ring-1 ring-black/5 p-7 sm:p-8 mb-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-6">Price History</h2>

        <div class="grid grid-cols-3 gap-4 mb-6">
          <div>
            <p class="text-xs text-gray-600 mb-1">Lowest Price</p>
            <p class="text-xl font-semibold text-green-600">
              $<%= number_with_precision(@product.lowest_price, precision: 2) %>
            </p>
          </div>

          <div>
            <p class="text-xs text-gray-600 mb-1">Highest Price</p>
            <p class="text-xl font-semibold text-red-600">
              $<%= number_with_precision(@product.highest_price, precision: 2) %>
            </p>
          </div>

          <div>
            <p class="text-xs text-gray-600 mb-1">30-Day Average</p>
            <p class="text-xl font-semibold text-gray-900">
              $<%= number_with_precision(@product.average_price(days: 30), precision: 2) %>
            </p>
          </div>
        </div>
      </div>
    <% end %>

    <div class="bg-white rounded-xl shadow-sm ring-1 ring-black/5 p-7 sm:p-8">
      <% if @price_alert %>
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-lg font-semibold text-gray-900">Price Alert</h2>
          <% if @price_alert.active? %>
            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
              Active
            </span>
          <% else %>
            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-600">
              Inactive
            </span>
          <% end %>
        </div>

        <div class="flex items-center gap-3">
          <%= button_to toggle_price_alert_path(@price_alert),
                method: :patch,
                class: price_alert_button_classes(@price_alert.active?) do %>
            <%= @price_alert.active? ? 'Pause' : 'Resume' %> Alert
          <% end %>

          <button
            type="button"
            data-action="click->modal#open"
            class="inline-flex items-center gap-1.5 rounded-full border border-transparent bg-red-600 px-4 py-2 text-sm font-medium text-white hover:bg-red-700 transition cursor-pointer"
          >
            Delete Alert
          </button>
        </div>

        <%= render 'layouts/delete_modal',
              title: @product.name,
              message: "Are you sure you want to delete the price alert?",
              path: price_alert_path(@price_alert),
              method: :delete,
              button_text: 'Delete' %>
        </div>
      <% else %>
        <h2 class="text-lg font-semibold text-gray-900 mb-6">Create Price Alert</h2>

        <%= form_with model: @new_alert, url: product_price_alerts_path(@product) do |f| %>
          <div class="mb-6 space-y-3">
            <%= f.label :target_price, "Target Price", class: "text-sm/5 font-medium text-gray-900" %>
            <div class="relative max-w-xs">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 text-sm">$</span>
              <%= f.number_field :target_price,
                  step: 0.01,
                  required: true,
                  placeholder: "99.99",
                  class: "block w-full pl-8 rounded-lg border border-transparent shadow-sm ring-1 ring-black/10 px-3 py-2 text-base/6 sm:text-sm/6 focus:outline-2 focus:-outline-offset-1 focus:outline-black transition" %>
            </div>
            <p class="text-xs text-gray-600">You'll be notified when the price drops to this amount or lower</p>
          </div>

          <%= f.submit "Create Alert", class: "inline-flex items-center gap-1.5 rounded-full border border-transparent bg-gray-950 px-5 py-2 text-sm font-semibold text-white hover:bg-gray-800 transition cursor-pointer shadow-md" %>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
</div>
